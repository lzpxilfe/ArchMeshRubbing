# ArchMeshRubbing

고고학 유물의 3D 스캔 메쉬를 평면으로 펼쳐 탁본과 유사한 이미지를 생성하는 도구입니다.

## 주요 기능

- **메쉬 평면화**: ARAP 알고리즘으로 곡면을 왜곡 최소화하며 펼침
- **정사투영**: 3D 메쉬의 평면도 생성
- **표면 분리**: 내면/외면 자동 감지 + 사용자 지정(면 선택/할당)
- **통합 SVG 출력**: 실측(Top 외곽선) + 단면 + 내/외면 탁본을 1회 SVG로 저장
- **영역 선택**: 미구 등 특정 부분만 추출
- **스케일 출력**: 실측 스케일이 맞춰진 이미지 내보내기

## 설치

```bash
pip install -r requirements.txt
```

## 실행

### GUI (추천)

```bash
python app_interactive.py
```

### CLI

```bash
python main.py --help
```

## 2D 실측 도면(SVG) 내보내기

- GUI에서 `상/하/전/후/좌/우` 뷰를 본 뒤 **2D 실측 도면 내보내기(SVG)** 메뉴로 저장할 수 있습니다.

## 통합 SVG(실측+단면+내/외면 탁본) 내보내기

한 번의 SVG 내보내기로 아래를 한 시트에 함께 저장합니다.

- **Top 외곽선 실측(벡터)** + (선택) **단면선/단면 폴리라인(벡터)**
- **외면 탁본(이미지)** / **내면 탁본(이미지)** *(SVG 안에 PNG로 포함)*

권장 워크플로우:

1) (권장) **메쉬 정렬**: 바닥면 정렬(3점/면/브러시) 기능으로 “위/아래(Z-up)”가 맞게 정렬  
2) **내/외면 지정** (자동이 이상하면 꼭 필요)  
   - 우측 **펼침** 패널 → “표면 선택/지정”에서 **대상(외면/내면/미구)** 선택  
   - “찍기(자동 확장)”으로 표면을 클릭해 지정 *(Shift/Ctrl=추가, Alt=제거, ESC=종료)*  
   - “보정(브러시)”로 드래그 칠하기/지우기 *(Alt=지우기)*  
   - “면적(Area)”로 화면에서 다각형을 그려 보이는 면을 한 번에 지정 *(좌클릭=점 추가(드래그=회전), 우클릭/Enter=확정, Backspace=되돌리기, Alt=제거)*  
   - (옵션) “자동 분리(실험)”은 메쉬/정렬 상태에 따라 실패할 수 있어 보조용입니다  
3) (옵션) **단면선 입력**: 우측 단면 패널에서 단면선/ROI를 잡아두면 통합 SVG에 함께 포함됩니다  
4) **내보내기**: 우측 내보내기 패널 → “통합 SVG (실측+단면+내/외면 탁본)”

참고:
- “미구 전개/펼침”은 아직 후순위(미구 지정은 저장만 됨)입니다.
- 내/외면을 지정하지 않으면 자동 분리(법선 기준)로 fallback 됩니다.

## 단축키

- `[` / `]`: 회전 기즈모 크기 줄이기/키우기
- `F`: 선택 객체 화면 맞춤
- `R`: 카메라 리셋

## 환경 변수 (트러블슈팅)

- `ARCHMESHRUBBING_PROFILE_EXPORT_SAFE=1`: SVG 외곽선/가이드 투영을 보수적으로 처리 (Illustrator에서 `격자 + 긴 직선`만 보일 때 권장)
- `ARCHMESHRUBBING_DISABLE_OPENCV=1`: OpenCV 비활성화 (SciPy 기반 경로 사용)
- `ARCHMESHRUBBING_CV2_IMPORT_TIMEOUT=2.0`: OpenCV import smoke-test 타임아웃(초)

## 지원 포맷

- OBJ (Wavefront)
- PLY (Polygon File Format)
- STL (Stereolithography)
- OFF (Object File Format)

## 라이선스

MIT License
